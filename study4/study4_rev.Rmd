---
title: "Study 4"
subtitle: "Luhrmann, Weisman, et al."
output: 
  html_notebook:
    theme: flatly
    toc: true
    toc_float: true
---

In Study 4, college undergraduates completed a survey consisting of nine measures, including two indices of porosity, the Absorption scale, two indices of spiritual experience, two indices of more secular extraordinary experience, and two control measures.

This notebook contains all of the analyses for Study 4, which closely follow our preregistration of this study (link: https://osf.io/kmtc4)

```{r, message = F}
source("../scripts_general/dependencies.R")
source("../scripts_general/custom_funs.R")
source("../scripts_general/var_recode_contrast.R")
source("../scripts_general/data_load.R")
```

```{r}
detach("package:lmerTest")
require(stargazer)
```

```{r}
# custom function for substituting interaction symbol
sub_interact_fun <- function(str) {
  str <- gsub("\\`", "", str) # for `Porosity Vignettes`, etc.
  str <- gsub("\\.\\:", "\\. × ", str) # for country
  str <- gsub("\\:Cou", " × Cou", str)
  str <- gsub("\\:Sit", " × Sit", str)
  str <- gsub("\\:Rel", " × Rel", str)
  str <- gsub("\\:Pop", " × Pop", str)
  str <- gsub("\\:Por", " × Por", str)
  str <- gsub("\\:Abs", " × Abs", str)
  str <- gsub("\\:Gen", " × Gen", str)
  str <- gsub("\\:Age", " × Age", str)
  str <- gsub("\\:Edu", " × Edu", str)
  str <- gsub("\\:Pre", " × Pre", str)
  return(str)
}
```

```{r}
# show contrasts
contrasts(d4$country)
```


# Demographics

```{r}
d4_demo <- d4 %>% select(-contains("score")) %>% 
  mutate(male = ifelse(grepl("male", tolower(subject_gender)) &
                         !grepl("female", tolower(subject_gender)), 1, 0),
         female = ifelse(grepl("female", tolower(subject_gender)), 1, 0),
         subject_age = ifelse(subject_age > 120, NA_real_, subject_age),
         urban = ifelse(subject_urban_rural == "urban", 1, 0),
         subject_religion = case_when( # deal with religion
           subject_religion %in% 
             c("A.O.G.", "Anglican", "AoG", "AOG", "AOG (Assembly of God)",
               "Apostolic Life Ministry", "Assemblies of God", "Assemblies of God (AOG)",
               "Baptism", "Bible Church", "Bible Church of Vanuatu", "catholic",
               "Catholic", "catholicism", "Catholicism", "Catholicism / Christianism",
               "Chirstianity", "Christian", "Christian Mission Center",
               "Christian religion", "Christianianity", "christianity",
               "Christianity", "Church of Christ", "CMC", "CMC Church", "COC",
               "Living Water [Fresh waters]", "Living Wota (Freshwotas)", "Methodist",
               "New Governant Church of Vanuatu", "NTM", "only Christian",
               "Only Christian", "Only Christian!", "Pilow of Five Ministry",
               "Praise & Worship", "Presbyterian", "Roman Catholic", "S.D.A",
               "S.D.A. Youth", "Sabbath", "SDA (Saturday)", "SDA (Seventh Day Adventist)",
               "SDA, Seventh Day Adventist", "Seventh Day Adventist", "Sunday",
               "Sunday worship", "Sunday Worship", 
               "The Church of Jesus Christ of Latter Day Saints",
               "United Methodist Christian") ~ "Christian",
           subject_religion %in% 
             c("Buddhist", "Buddhism") ~ "Buddhist",
           subject_religion %in%
             c("Muslim", "Islam", "Islam / Mohammedanism", "Islam/Mohammedanism",
               "Some Islam habits") ~ "Muslim",
           grepl("agnost", tolower(subject_religion)) |
             grepl("atheis", tolower(subject_religion)) |
             grepl("don't", tolower(subject_religion)) |
             grepl("none", tolower(subject_religion)) |
             subject_religion == "." | is.na(subject_religion) |
             tolower(subject_religion) %in% 
             c("n/a", "no", "no religion", 
               "no religion, finding one", "not really") ~ "Agnostic/Atheist",
           subject_religion %in% c("missing data", "mdata", "NA") |
             is.na(subject_religion) ~ "Missing data",
           TRUE ~ "Other"),
         agnostic_atheist = (subject_religion == "Agnostic/Atheist"),
         buddhist = (subject_religion == "Buddhist"),
         christian = (subject_religion == "Christian"),
         muslim = (subject_religion == "Muslim"),
         other = (subject_religion == "Other"),
         missing = (subject_religion == "Missing data"))
```

```{r}
d4_demo %>%
  group_by(country) %>%
  summarise(n = n(),
            age_range = paste0(min(subject_age, na.rm = T), "-",
                               max(subject_age, na.rm = T)),
            mean_age = mean(subject_age, na.rm = T),
            percent_male = mean(male, na.rm = T),
            percent_female = mean(female, na.rm = T),
            percent_urban = mean(urban, na.rm = T),
            percent_affr = mean(subject_afford, na.rm = T),
            mean_ses = mean(subject_ses, na.rm = T),
            mean_religiosity = mean(subject_religiosity, na.rm = T),
            percent_christian = mean(christian, na.rm = T),
            percent_agnostic_atheist = mean(agnostic_atheist, na.rm = T),
            percent_buddhist = mean(buddhist, na.rm = T),
            percent_muslim = mean(muslim, na.rm = T),
            percent_other = mean(other, na.rm = T),
            percent_missing = mean(missing, na.rm = T)) %>%
  ungroup() %>%
  # mutate_at(vars(starts_with("mean_")), funs(format(round(., 2), nsmall = 2))) %>%
  mutate_at(vars(starts_with("percent_")),
            funs(paste0(round(. * 100), "%"))) %>%
  rename(Country = country, 
         `Age range` = age_range, `Mean age` = mean_age,
         `% male` = percent_male, `% female` = percent_female,
         `% urban` = percent_urban, `% can afford` = percent_affr,
         `Mean SES` = mean_ses, `Mean religiosity` = mean_religiosity,
         `% Christian` = percent_christian, 
         `% Agnostic/Atheist` = percent_agnostic_atheist, 
         `% Buddhist` = percent_buddhist, 
         `% Muslim` = percent_muslim, 
         `% Other` = percent_other,
         `[% Missing data]` = percent_missing) %>%
  mutate(Country = factor(Country, levels = levels_country)) %>%
  arrange(Country) %>%
  select(Country, n, `Age range`, `Mean age`, `% male`, `% female`,
         `Mean religiosity`,
         `% Christian`, `% Buddhist`, `% Muslim`, `% Other`, `% Agnostic/Atheist`,
         `[% Missing data]`,
         `% urban`, `% can afford`, `Mean SES`) %>%
  kable(digits = 2, align = c(rep("l", 2), rep("r", ncol(.) - 2))) %>%
  kable_styling(font_size = 16) # %>%
# collapse_rows(1:2)
```


# Revised analyses (July 2020)

```{r}
d4_fortab <- d4 %>%
  mutate_at(vars(ends_with("_score"), subject_age), scale) %>%
  mutate(subject_gender = factor(subject_gender, 
                                 levels = c("female", "male"))) %>%
  rename("Spiritual Events" = "spev_score",
         "Daily Spiritual Experience" = "dse_score",
         "Porosity Vignettes" = "pv_score",
         "Porosity Scale" = "por_score",
         "Absorption" = "abs_score",
         "Hallucinations" = "hall_score",
         "Paranormal" = "para_score",
         "Need for Cognition" = "cog_score",
         "Sense of Control" = "ctl_score",
         "Country" = "country",
         "Gender" = "subject_gender",
         "Age" = "subject_age")

contrasts(d4_fortab$Country) <- cbind(": Gh." = c(-1, 1, 0, 0, 0),
                                      ": Th." = c(-1, 0, 1, 0, 0),
                                      ": Ch." = c(-1, 0, 0, 1, 0),
                                      ": Va." = c(-1, 0, 0, 0, 1))
contrasts(d4_fortab$Gender) <- cbind(": male" = c(-1, 1))
```

## Group differences

### Spiritual Events

```{r}
r01_spev <- lm(`Spiritual Events` ~ Country,
               data = d4_fortab)
r02_spev <- lm(`Spiritual Events` ~ Country
               + Gender + Age,
               data = d4_fortab)
```

```{r, include = F}
# # run manually to check convergence
# summary(r01_spev)
# summary(r02_spev)
```

```{r, include=F}
table_s4_diff_spev <- stargazer(r01_spev, r02_spev, type = "html",
                                ci = T,
                                report = c("vcsp"),
                                digits = 2,
                                digits.extra = 1000,
                                omit.table.layout = "n",
                                # order = c("^Country: ...$", 
                                #           "Country"),
                                dep.var.labels.include = F,
                                dep.var.caption = "",
                                single.row = T)

cat(sub_interact_fun(table_s4_diff_spev), 
    file = "./stargazer_tables/table_s4_diff_spev.html")
```

### Daily Spiritual Experience

```{r}
r01_dse <- lm(`Daily Spiritual Experience` ~ Country,
              data = d4_fortab)
r02_dse <- lm(`Daily Spiritual Experience` ~ Country
              + Gender + Age,
              data = d4_fortab)
```

```{r, include = F}
# # run manually to check convergence
# summary(r01_dse)
# summary(r02_dse)
```

```{r, include=F}
table_s4_diff_dse <- stargazer(r01_dse, r02_dse, type = "html",
                               ci = T,
                               report = c("vcsp"),
                               digits = 2,
                               digits.extra = 1000,
                               omit.table.layout = "n",
                               # order = c("^Country: ...$", 
                               #           "Country"),
                               dep.var.labels.include = F,
                               dep.var.caption = "",
                               single.row = T)

cat(sub_interact_fun(table_s4_diff_dse), 
    file = "./stargazer_tables/table_s4_diff_dse.html")
```

### Porosity Vignettes

```{r}
r01_pv <- lm(`Porosity Vignettes` ~ Country,
             data = d4_fortab)
r02_pv <- lm(`Porosity Vignettes` ~ Country
             + Gender + Age,
             data = d4_fortab)
```

```{r, include = F}
# # run manually to check convergence
# summary(r01_pv)
# summary(r02_pv)
```

```{r, include=F}
table_s4_diff_pv <- stargazer(r01_pv, r02_pv, type = "html",
                              ci = T,
                              report = c("vcsp"),
                              digits = 2,
                              digits.extra = 1000,
                              omit.table.layout = "n",
                              # order = c("^Country: ...$", 
                              #           "Country"),
                              dep.var.labels.include = F,
                              dep.var.caption = "",
                              single.row = T)

cat(sub_interact_fun(table_s4_diff_pv), 
    file = "./stargazer_tables/table_s4_diff_pv.html")
```

### Porosity Scale

```{r}
r01_por <- lm(`Porosity Scale` ~ Country,
              data = d4_fortab)
r02_por <- lm(`Porosity Scale` ~ Country
              + Gender + Age,
              data = d4_fortab)
```

```{r, include = F}
# # run manually to check convergence
# summary(r01_por)
# summary(r02_por)
```

```{r, include=F}
table_s4_diff_por <- stargazer(r01_por, r02_por, type = "html",
                               ci = T,
                               report = c("vcsp"),
                               digits = 2,
                               digits.extra = 1000,
                               omit.table.layout = "n",
                               # order = c("^Country: ...$", 
                               #           "Country"),
                               dep.var.labels.include = F,
                               dep.var.caption = "",
                               single.row = T)

cat(sub_interact_fun(table_s4_diff_por), 
    file = "./stargazer_tables/table_s4_diff_por.html")
```

### Absorption

```{r}
r01_abs <- lm(`Absorption` ~ Country,
              data = d4_fortab)
r02_abs <- lm(`Absorption` ~ Country
              + Gender + Age,
              data = d4_fortab)
```

```{r, include = F}
# # run manually to check convergence
# summary(r01_abs)
# summary(r02_abs)
```

```{r, include=F}
table_s4_diff_abs <- stargazer(r01_abs, r02_abs, type = "html",
                               ci = T,
                               report = c("vcsp"),
                               digits = 2,
                               digits.extra = 1000,
                               omit.table.layout = "n",
                               # order = c("^Country: ...$", 
                               #           "Country"),
                               dep.var.labels.include = F,
                               dep.var.caption = "",
                               single.row = T)

cat(sub_interact_fun(table_s4_diff_abs), 
    file = "./stargazer_tables/table_s4_diff_abs.html")
```

### Hallucinations

```{r}
r01_hall <- lm(`Hallucinations` ~ Country,
               data = d4_fortab)
r02_hall <- lm(`Hallucinations` ~ Country
               + Gender + Age,
               data = d4_fortab)
```

```{r, include = F}
# # run manually to check convergence
# summary(r01_hall)
# summary(r02_hall)
```

```{r, include=F}
table_s4_diff_hall <- stargazer(r01_hall, r02_hall, type = "html",
                                ci = T,
                                report = c("vcsp"),
                                digits = 2,
                                digits.extra = 1000,
                                omit.table.layout = "n",
                                # order = c("^Country: ...$", 
                                #           "Country"),
                                dep.var.labels.include = F,
                                dep.var.caption = "",
                                single.row = T)

cat(sub_interact_fun(table_s4_diff_hall), 
    file = "./stargazer_tables/table_s4_diff_hall.html")
```

### Paranormal

```{r}
r01_para <- lm(`Paranormal` ~ Country,
               data = d4_fortab)
r02_para <- lm(`Paranormal` ~ Country
               + Gender + Age,
               data = d4_fortab)
```

```{r, include = F}
# # run manually to check convergence
# summary(r01_para)
# summary(r02_para)
```

```{r, include=F}
table_s4_diff_para <- stargazer(r01_para, r02_para, type = "html",
                                ci = T,
                                report = c("vcsp"),
                                digits = 2,
                                digits.extra = 1000,
                                omit.table.layout = "n",
                                # order = c("^Country: ...$", 
                                #           "Country"),
                                dep.var.labels.include = F,
                                dep.var.caption = "",
                                single.row = T)

cat(sub_interact_fun(table_s4_diff_para), 
    file = "./stargazer_tables/table_s4_diff_para.html")
```

### Need for Cognition

```{r}
r01_cog <- lm(`Need for Cognition` ~ Country,
              data = d4_fortab)
r02_cog <- lm(`Need for Cognition` ~ Country
              + Gender + Age,
              data = d4_fortab)
```

```{r, include = F}
# # run manually to check convergence
# summary(r01_cog)
# summary(r02_cog)
```

```{r, include=F}
table_s4_diff_cog <- stargazer(r01_cog, r02_cog, type = "html",
                               ci = T,
                               report = c("vcsp"),
                               digits = 2,
                               digits.extra = 1000,
                               omit.table.layout = "n",
                               # order = c("^Country: ...$", 
                               #           "Country"),
                               dep.var.labels.include = F,
                               dep.var.caption = "",
                               single.row = T)

cat(sub_interact_fun(table_s4_diff_cog), 
    file = "./stargazer_tables/table_s4_diff_cog.html")
```

### Sense of Control

```{r}
r01_ctl <- lm(`Sense of Control` ~ Country,
              data = d4_fortab)
r02_ctl <- lm(`Sense of Control` ~ Country
              + Gender + Age,
              data = d4_fortab)
```

```{r, include = F}
# # run manually to check convergence
# summary(r01_ctl)
# summary(r02_ctl)
```

```{r, include=F}
table_s4_diff_ctl <- stargazer(r01_ctl, r02_ctl, type = "html",
                               ci = T,
                               report = c("vcsp"),
                               digits = 2,
                               digits.extra = 1000,
                               omit.table.layout = "n",
                               # order = c("^Country: ...$", 
                               #           "Country"),
                               dep.var.labels.include = F,
                               dep.var.caption = "",
                               single.row = T)

cat(sub_interact_fun(table_s4_diff_ctl), 
    file = "./stargazer_tables/table_s4_diff_ctl.html")
```

## Relationships: Spiritual experiences

```{r}
d4_fortab_long <- d4_fortab %>% 
  gather(Scale, Score, 
         c(`Spiritual Events`, `Daily Spiritual Experience`)) %>%
  mutate(Scale = factor(Scale))

contrasts(d4_fortab_long$Scale) <- cbind(": Spiritual Events" = c(-1, 1))
```

#### Sample as fixed effect

```{r}
r03_spirit <- lmer(Score ~ Scale * `Porosity Vignettes`
                   + (1 | subject_id),
                   data = d4_fortab_long)

r04_spirit <- lmer(Score ~ Scale * `Porosity Scale`
                   + (1 | subject_id),
                   data = d4_fortab_long)

r05_spirit <- lmer(Score ~ Scale * Absorption
                   + (1 | subject_id),
                   data = d4_fortab_long)

r06_spirit <- lmer(Score ~ Scale * Country * `Porosity Vignettes`
                   + (1 | subject_id),
                   data = d4_fortab_long)

r07_spirit <- lmer(Score ~ Scale * Country * `Porosity Scale`
                   + (1 | subject_id),
                   data = d4_fortab_long)

r08_spirit <- lmer(Score ~ Scale * Country * Absorption
                   + (1 | subject_id),
                   data = d4_fortab_long)

r09_spirit <- lmer(Score ~ Scale * Country * `Porosity Vignettes` * Absorption
                   + (1 | subject_id),
                   data = d4_fortab_long)

r10_spirit <- lmer(Score ~ Scale * Country * `Porosity Scale` * Absorption
                   + (1 | subject_id),
                   data = d4_fortab_long)

r11_spirit <- lmer(Score ~ Scale * Country * `Porosity Vignettes` * Absorption
                   + Gender + Age
                   + (1 | subject_id),
                   data = d4_fortab_long)

r12_spirit <- lmer(Score ~ Scale * Country * `Porosity Scale` * Absorption
                   + Gender + Age
                   + (1 | subject_id),
                   data = d4_fortab_long)
```

```{r, include = F}
# # run manually to check convergence
# summary(r03_spirit)
# summary(r04_spirit)
# summary(r05_spirit)
# summary(r06_spirit)
# summary(r07_spirit)
# summary(r08_spirit)
# summary(r09_spirit)
# summary(r10_spirit)
# summary(r11_spirit)
# summary(r12_spirit)
```

```{r, include=F}
table_s4_rel_spirit_pv_fixfx <- stargazer(r03_spirit, #r04_spirit, 
                                          r05_spirit, r06_spirit, #r07_spirit, 
                                          r08_spirit, r09_spirit, #r10_spirit,
                                          r11_spirit, #r12_spirit, 
                                          type = "html",
                                          ci = T,
                                          report = c("vcsp"),
                                          digits = 2,
                                          digits.extra = 1000,
                                          omit.table.layout = "n",
                                          order = c("^`Porosity Vignettes`$",
                                                    "^Absorption$",
                                                    "^`Porosity Vignettes`:Absorption$"),
                                          dep.var.labels.include = F,
                                          dep.var.caption = "",
                                          single.row = T) 

cat(sub_interact_fun(table_s4_rel_spirit_pv_fixfx), 
    file = "./stargazer_tables/table_s4_rel_spirit_pv_fixfx.html")
```

```{r}
rsquared(modelList = list(r03_spirit, #r04_spirit, 
                          r05_spirit, r06_spirit, #r07_spirit, 
                          r08_spirit, r09_spirit, #r10_spirit,
                          r11_spirit#, r12_spirit
)) %>%
  mutate_at(vars(Marginal, Conditional), ~ round(., 2))
```
```{r, include=F}
table_s4_rel_spirit_por_fixfx <- stargazer(#r03_spirit, 
  r04_spirit, r05_spirit, #r06_spirit,
  r07_spirit, r08_spirit, #r09_spirit, 
  r10_spirit, #r11_spirit, 
  r12_spirit, 
  type = "html",
  ci = T,
  report = c("vcsp"),
  digits = 2,
  digits.extra = 1000,
  omit.table.layout = "n",
  order = c("^`Porosity Scale`$",
            "^Absorption$",
            "^`Porosity Scale`:Absorption$"),
  dep.var.labels.include = F,
  dep.var.caption = "",
  single.row = T) 

cat(sub_interact_fun(table_s4_rel_spirit_por_fixfx), 
    file = "./stargazer_tables/table_s4_rel_spirit_por_fixfx.html")
```

```{r}
rsquared(modelList = list(#r03_spirit, 
  r04_spirit, r05_spirit, #r06_spirit, 
  r07_spirit, r08_spirit, #r09_spirit, 
  r10_spirit, #r11_spirit
  r12_spirit )) %>%
  mutate_at(vars(Marginal, Conditional), ~ round(., 2))
```
#### Sample as random effect

```{r}
r11_spirit <- lmer(Score ~ Scale
                   + (1 | Country/subject_id),
                   data = d4_fortab_long)

r12_spirit <- lmer(Score ~ Scale * `Porosity Vignettes`
                   + (1 | Country/subject_id),
                   # + (1 + `Porosity Vignettes` | Country), # adding to above, failed to converge
                   data = d4_fortab_long)

r13_spirit <- lmer(Score ~ Scale * `Porosity Scale`
                   + (1 | Country/subject_id),
                   # + (1 + `Porosity Scale` | Country), # adding to above, perfectly correlated ranfx
                   data = d4_fortab_long)

r14_spirit <- lmer(Score ~ Scale * Absorption
                   + (1 | Country/subject_id),
                   # + (1 + Absorption | Country), # adding to above, perfectly correlated ranfx
                   data = d4_fortab_long)

r15_spirit <- lmer(Score ~ Scale * `Porosity Vignettes` * Absorption
                   + (1 | Country/subject_id),
                   # + (1 + `Porosity Vignettes` * Absorption | Country), # adding to above, perfectly correlated ranfx
                   data = d4_fortab_long)

r16_spirit <- lmer(Score ~ Scale * `Porosity Scale` * Absorption
                   + (1 | Country/subject_id), 
                   # + (1 + `Porosity Scale` * Absorption | Country), # adding to above, perfectly correlated ranfx
                   data = d4_fortab_long)

r17_spirit <- lmer(Score ~ Scale * `Porosity Vignettes` * Absorption
                   + Gender + Age
                   + (1 | Country/subject_id),
                   # + (1 + `Porosity Vignettes` * Absorption + Gender + Age | Country),
                   data = d4_fortab_long)

r18_spirit <- lmer(Score ~ Scale * `Porosity Scale` * Absorption
                   + Gender + Age
                   + (1 | Country/subject_id),
                   # + (1 + `Porosity Scale` * Absorption + Gender + Age | Country),
                   data = d4_fortab_long)
```

```{r, include = F}
# # run manually to check convergence
# summary(r11_spirit)
# summary(r12_spirit)
# summary(r13_spirit)
# summary(r14_spirit)
# summary(r15_spirit)
# summary(r16_spirit)
# summary(r17_spirit)
# summary(r18_spirit)
```

```{r, include=F}
table_s4_rel_spirit_pv_ranfx <- stargazer(r11_spirit, r12_spirit,
                                          r14_spirit, r15_spirit, 
                                          r17_spirit, 
                                          type = "html",
                                          ci = T,
                                          report = c("vcsp"),
                                          digits = 2,
                                          digits.extra = 1000,
                                          omit.table.layout = "n",
                                          order = c("^`Porosity Vignettes`$",
                                                    "^Absorption$",
                                                    "^`Porosity Vignettes`:Absorption$"),
                                          dep.var.labels.include = F,
                                          dep.var.caption = "",
                                          single.row = T)

cat(sub_interact_fun(table_s4_rel_spirit_pv_ranfx), 
    file = "./stargazer_tables/table_s4_rel_spirit_pv_ranfx.html")
```

```{r}
rsquared(modelList = list(r11_spirit, r12_spirit, r14_spirit, 
                          r15_spirit, r17_spirit)) %>%
  mutate_at(vars(Marginal, Conditional), ~ round(., 2))
```

```{r, include=F}
table_s4_rel_spirit_por_ranfx <- stargazer(r11_spirit, r13_spirit,
                                           r14_spirit, r16_spirit, 
                                           r18_spirit, 
                                           type = "html",
                                           ci = T,
                                           report = c("vcsp"),
                                           digits = 2,
                                           digits.extra = 1000,
                                           omit.table.layout = "n",
                                           order = c("^`Porosity Vignettes`$",
                                                     "^Absorption$",
                                                     "^`Porosity Vignettes`:Absorption$"),
                                           dep.var.labels.include = F,
                                           dep.var.caption = "",
                                           single.row = T)

cat(sub_interact_fun(table_s4_rel_spirit_por_ranfx), 
    file = "./stargazer_tables/table_s4_rel_spirit_por_ranfx.html")
```

```{r}
rsquared(modelList = list(r11_spirit, r13_spirit, r14_spirit, 
                          r16_spirit, r18_spirit)) %>%
  mutate_at(vars(Marginal, Conditional), ~ round(., 2))
```

#### By country

##### Porosity Vignettes

```{r}
r19_spirit_us <- lmer(Score ~ Scale * `Porosity Vignettes` 
                      + (1 | subject_id),
                      data = d4_fortab_long %>% filter(Country == "US") %>%
                        mutate_at(vars(Score, `Porosity Vignettes`), ~ scale(.)))

r19_spirit_gh <- lmer(Score ~ Scale * `Porosity Vignettes` 
                      + (1 | subject_id),
                      data = d4_fortab_long %>% filter(Country == "Ghana") %>%
                        mutate_at(vars(Score, ,`Porosity Vignettes`), ~ scale(.)))

r19_spirit_th <- lmer(Score ~ Scale * `Porosity Vignettes` 
                      + (1 | subject_id),
                      data = d4_fortab_long %>% filter(Country == "Thailand") %>%
                        mutate_at(vars(Score, `Porosity Vignettes`), ~ scale(.)))

r19_spirit_ch <- lmer(Score ~ Scale * `Porosity Vignettes` 
                      + (1 | subject_id),
                      data = d4_fortab_long %>% filter(Country == "China") %>%
                        mutate_at(vars(Score, `Porosity Vignettes`), ~ scale(.)))

r19_spirit_vt <- lmer(Score ~ Scale * `Porosity Vignettes` 
                      + (1 | subject_id),
                      data = d4_fortab_long %>% filter(Country == "Vanuatu") %>%
                        mutate_at(vars(Score, `Porosity Vignettes`), ~ scale(.)))
```

```{r, include = F}
# # run manually to check convergence
# summary(r19_spirit_us)
# summary(r19_spirit_gh)
# summary(r19_spirit_th)
# summary(r19_spirit_ch)
# summary(r19_spirit_vt)
```

```{r, include=F}
table_s4_rel_bycountry_spirit_pv <- stargazer(r19_spirit_us, r19_spirit_gh,
                                              r19_spirit_th, r19_spirit_ch, 
                                              r19_spirit_vt, 
                                              type = "html",
                                              ci = T,
                                              report = c("vcsp"),
                                              digits = 2,
                                              digits.extra = 1000,
                                              omit.table.layout = "n",
                                              order = c("^`Porosity Vignettes`$",
                                                        "^Absorption$",
                                                        "^`Porosity Vignettes`:Absorption$"),
                                              dep.var.labels.include = F,
                                              dep.var.caption = "",
                                              single.row = T)

cat(sub_interact_fun(table_s4_rel_bycountry_spirit_pv), 
    file = "./stargazer_tables/table_s4_rel_bycountry_spirit_pv.html")
```

```{r}
rsquared(modelList = list(r19_spirit_us, r19_spirit_gh, r19_spirit_th, 
                          r19_spirit_ch, r19_spirit_vt)) %>%
  mutate_at(vars(Marginal, Conditional), ~ round(., 2))
```

##### Porosity Scale

```{r}
r20_spirit_us <- lmer(Score ~ Scale * `Porosity Scale` 
                      + (1 | subject_id),
                      data = d4_fortab_long %>% filter(Country == "US") %>%
                        mutate_at(vars(Score, `Porosity Scale`), ~ scale(.)))

r20_spirit_gh <- lmer(Score ~ Scale * `Porosity Scale` 
                      + (1 | subject_id),
                      data = d4_fortab_long %>% filter(Country == "Ghana") %>%
                        mutate_at(vars(Score, `Porosity Scale`), ~ scale(.)))

r20_spirit_th <- lmer(Score ~ Scale * `Porosity Scale` 
                      + (1 | subject_id),
                      data = d4_fortab_long %>% filter(Country == "Thailand") %>%
                        mutate_at(vars(Score, `Porosity Scale`), ~ scale(.)))

r20_spirit_ch <- lmer(Score ~ Scale * `Porosity Scale` 
                      + (1 | subject_id),
                      data = d4_fortab_long %>% filter(Country == "China") %>%
                        mutate_at(vars(Score, `Porosity Scale`), ~ scale(.)))

r20_spirit_vt <- lmer(Score ~ Scale * `Porosity Scale` 
                      + (1 | subject_id),
                      data = d4_fortab_long %>% filter(Country == "Vanuatu") %>%
                        mutate_at(vars(Score, `Porosity Scale`), ~ scale(.)))
```

```{r, include = F}
# # run manually to check convergence
# summary(r20_spirit_us)
# summary(r20_spirit_gh)
# summary(r20_spirit_th)
# summary(r20_spirit_ch)
# summary(r20_spirit_vt)
```

```{r, include=F}
table_s4_rel_bycountry_spirit_por <- stargazer(r20_spirit_us, r20_spirit_gh,
                                               r20_spirit_th, r20_spirit_ch, 
                                               r20_spirit_vt, 
                                               type = "html",
                                               ci = T,
                                               report = c("vcsp"),
                                               digits = 2,
                                               digits.extra = 1000,
                                               omit.table.layout = "n",
                                               order = c("^`Porosity Scale`$",
                                                         "^Absorption$",
                                                         "^`Porosity Scale`:Absorption$"),
                                               dep.var.labels.include = F,
                                               dep.var.caption = "",
                                               single.row = T)

cat(sub_interact_fun(table_s4_rel_bycountry_spirit_por), 
    file = "./stargazer_tables/table_s4_rel_bycountry_spirit_por.html")
```

```{r}
rsquared(modelList = list(r20_spirit_us, r20_spirit_gh, r20_spirit_th, 
                          r20_spirit_ch, r20_spirit_vt)) %>%
  mutate_at(vars(Marginal, Conditional), ~ round(., 2))
```

##### Absorption

```{r}
r21_spirit_us <- lmer(Score ~ Scale * `Absorption` 
                      + (1 | subject_id),
                      data = d4_fortab_long %>% filter(Country == "US") %>%
                        mutate_at(vars(Score, `Absorption`), ~ scale(.)))

r21_spirit_gh <- lmer(Score ~ Scale * `Absorption` 
                      + (1 | subject_id),
                      data = d4_fortab_long %>% filter(Country == "Ghana") %>%
                        mutate_at(vars(Score, `Absorption`), ~ scale(.)))

r21_spirit_th <- lmer(Score ~ Scale * `Absorption` 
                      + (1 | subject_id),
                      data = d4_fortab_long %>% filter(Country == "Thailand") %>%
                        mutate_at(vars(Score, `Absorption`), ~ scale(.)))

r21_spirit_ch <- lmer(Score ~ Scale * `Absorption` 
                      + (1 | subject_id),
                      data = d4_fortab_long %>% filter(Country == "China") %>%
                        mutate_at(vars(Score, `Absorption`), ~ scale(.)))

r21_spirit_vt <- lmer(Score ~ Scale * `Absorption` 
                      + (1 | subject_id),
                      data = d4_fortab_long %>% filter(Country == "Vanuatu") %>%
                        mutate_at(vars(Score, `Absorption`), ~ scale(.)))
```

```{r, include = F}
# # run manually to check convergence
# summary(r21_spirit_us)
# summary(r21_spirit_gh)
# summary(r21_spirit_th)
# summary(r21_spirit_ch)
# summary(r21_spirit_vt)
```

```{r, include=F}
table_s4_rel_bycountry_spirit_abs <- stargazer(r21_spirit_us, r21_spirit_gh,
                                               r21_spirit_th, r21_spirit_ch, 
                                               r21_spirit_vt, 
                                               type = "html",
                                               ci = T,
                                               report = c("vcsp"),
                                               digits = 2,
                                               digits.extra = 1000,
                                               omit.table.layout = "n",
                                               order = c("^Absorption$"),
                                               dep.var.labels.include = F,
                                               dep.var.caption = "",
                                               single.row = T)

cat(sub_interact_fun(table_s4_rel_bycountry_spirit_abs), 
    file = "./stargazer_tables/table_s4_rel_bycountry_spirit_abs.html")
```

```{r}
rsquared(modelList = list(r21_spirit_us, r21_spirit_gh, r21_spirit_th, 
                          r21_spirit_ch, r21_spirit_vt)) %>%
  mutate_at(vars(Marginal, Conditional), ~ round(., 2))
```

## Relationships: Secular experiences

```{r}
d4_fortab_secular_long <- d4_fortab %>% 
  gather(Scale, Score, 
         c(`Hallucinations`, `Paranormal`)) %>%
  mutate(Scale = factor(Scale))

contrasts(d4_fortab_secular_long$Scale) <- cbind(": Hallucinations" = c(1, -1))
```

#### Sample as fixed effect

```{r}
r03_secular <- lmer(Score ~ Scale * `Porosity Vignettes`
                    + (1 | subject_id),
                    data = d4_fortab_secular_long)

r04_secular <- lmer(Score ~ Scale * `Porosity Scale`
                    + (1 | subject_id),
                    data = d4_fortab_secular_long)

r05_secular <- lmer(Score ~ Scale * Absorption
                    + (1 | subject_id),
                    data = d4_fortab_secular_long)

r06_secular <- lmer(Score ~ Scale * Country * `Porosity Vignettes`
                    + (1 | subject_id),
                    data = d4_fortab_secular_long)

r07_secular <- lmer(Score ~ Scale * Country * `Porosity Scale`
                    + (1 | subject_id),
                    data = d4_fortab_secular_long)

r08_secular <- lmer(Score ~ Scale * Country * Absorption
                    + (1 | subject_id),
                    data = d4_fortab_secular_long)

r09_secular <- lmer(Score ~ Scale * Country * `Porosity Vignettes` * Absorption
                    + (1 | subject_id),
                    data = d4_fortab_secular_long)

r10_secular <- lmer(Score ~ Scale * Country * `Porosity Scale` * Absorption
                    + (1 | subject_id),
                    data = d4_fortab_secular_long)

r11_secular <- lmer(Score ~ Scale * Country * `Porosity Vignettes` * Absorption
                    + Gender + Age
                    + (1 | subject_id),
                    data = d4_fortab_secular_long)

r12_secular <- lmer(Score ~ Scale * Country * `Porosity Scale` * Absorption
                    + Gender + Age
                    + (1 | subject_id),
                    data = d4_fortab_secular_long)
```

```{r, include = F}
# # run manually to check convergence
# summary(r03_secular)
# summary(r04_secular)
# summary(r05_secular)
# summary(r06_secular)
# summary(r07_secular)
# summary(r08_secular)
# summary(r09_secular)
# summary(r10_secular)
# summary(r11_secular)
# summary(r12_secular)
```

```{r, include=F}
table_s4_rel_secular_pv_fixfx <- stargazer(r03_secular, #r04_secular, 
                                           r05_secular, r06_secular, #r07_secular, 
                                           r08_secular, r09_secular, #r10_secular,
                                           r11_secular, #r12_secular, 
                                           type = "html",
                                           ci = T,
                                           report = c("vcsp"),
                                           digits = 2,
                                           digits.extra = 1000,
                                           omit.table.layout = "n",
                                           order = c("^`Porosity Vignettes`$",
                                                     "^Absorption$",
                                                     "^`Porosity Vignettes`:Absorption$"),
                                           dep.var.labels.include = F,
                                           dep.var.caption = "",
                                           single.row = T) 

cat(sub_interact_fun(table_s4_rel_secular_pv_fixfx), 
    file = "./stargazer_tables/table_s4_rel_secular_pv_fixfx.html")
```

```{r}
rsquared(modelList = list(r03_secular, #r04_secular, 
                          r05_secular, r06_secular, #r07_secular, 
                          r08_secular, r09_secular, #r10_secular,
                          r11_secular#, r12_secular
)) %>%
  mutate_at(vars(Marginal, Conditional), ~ round(., 2))
```

```{r, include=F}
table_s4_rel_secular_por_fixfx <- stargazer(#r03_secular, 
  r04_secular, r05_secular, #r06_secular,
  r07_secular, r08_secular, #r09_secular, 
  r10_secular, #r11_secular, 
  r12_secular, 
  type = "html",
  ci = T,
  report = c("vcsp"),
  digits = 2,
  digits.extra = 1000,
  omit.table.layout = "n",
  order = c("^`Porosity Scale`$",
            "^Absorption$",
            "^`Porosity Scale`:Absorption$"),
  dep.var.labels.include = F,
  dep.var.caption = "",
  single.row = T) 

cat(sub_interact_fun(table_s4_rel_secular_por_fixfx), 
    file = "./stargazer_tables/table_s4_rel_secular_por_fixfx.html")
```

```{r}
rsquared(modelList = list(#r03_secular, 
  r04_secular, r05_secular, #r06_secular, 
  r07_secular, r08_secular, #r09_secular, 
  r10_secular, #r11_secular
  r12_secular )) %>%
  mutate_at(vars(Marginal, Conditional), ~ round(., 2))
```
#### Sample as random effect

```{r}
r11_secular <- lmer(Score ~ Scale
                    + (1 | Country/subject_id),
                    data = d4_fortab_secular_long)

r12_secular <- lmer(Score ~ Scale * `Porosity Vignettes`
                    + (1 | Country/subject_id),
                    # + (1 + `Porosity Vignettes` | Country), # adding to above, failed to converge
                    data = d4_fortab_secular_long)

r13_secular <- lmer(Score ~ Scale * `Porosity Scale`
                    + (1 | Country/subject_id),
                    # + (1 + `Porosity Scale` | Country), # adding to above, perfectly correlated ranfx
                    data = d4_fortab_secular_long)

r14_secular <- lmer(Score ~ Scale * Absorption
                    + (1 | Country/subject_id),
                    # + (1 + Absorption | Country), # adding to above, perfectly correlated ranfx
                    data = d4_fortab_secular_long)

r15_secular <- lmer(Score ~ Scale * `Porosity Vignettes` * Absorption
                    + (1 | Country/subject_id),
                    # + (1 + `Porosity Vignettes` * Absorption | Country), # adding to above, perfectly correlated ranfx
                    data = d4_fortab_secular_long)

r16_secular <- lmer(Score ~ Scale * `Porosity Scale` * Absorption
                    + (1 | Country/subject_id), 
                    # + (1 + `Porosity Scale` * Absorption | Country), # adding to above, perfectly correlated ranfx
                    data = d4_fortab_secular_long)

r17_secular <- lmer(Score ~ Scale * `Porosity Vignettes` * Absorption
                    + Gender + Age
                    + (1 | Country/subject_id),
                    # + (1 + `Porosity Vignettes` * Absorption + Gender + Age | Country),
                    data = d4_fortab_secular_long)

r18_secular <- lmer(Score ~ Scale * `Porosity Scale` * Absorption
                    + Gender + Age
                    + (1 | Country/subject_id),
                    # + (1 + `Porosity Scale` * Absorption + Gender + Age | Country),
                    data = d4_fortab_secular_long)
```

```{r, include = F}
# # run manually to check convergence
# summary(r11_secular)
# summary(r12_secular)
# summary(r13_secular)
# summary(r14_secular)
# summary(r15_secular)
# summary(r16_secular)
# summary(r17_secular)
# summary(r18_secular)
```

```{r, include=F}
table_s4_rel_secular_pv_ranfx <- stargazer(r11_secular, r12_secular,
                                           r14_secular, r15_secular, 
                                           r17_secular, 
                                           type = "html",
                                           ci = T,
                                           report = c("vcsp"),
                                           digits = 2,
                                           digits.extra = 1000,
                                           omit.table.layout = "n",
                                           order = c("^`Porosity Vignettes`$",
                                                     "^Absorption$",
                                                     "^`Porosity Vignettes`:Absorption$"),
                                           dep.var.labels.include = F,
                                           dep.var.caption = "",
                                           single.row = T)

cat(sub_interact_fun(table_s4_rel_secular_pv_ranfx), 
    file = "./stargazer_tables/table_s4_rel_secular_pv_ranfx.html")
```

```{r}
rsquared(modelList = list(r11_secular, r12_secular, r14_secular, 
                          r15_secular, r17_secular)) %>%
  mutate_at(vars(Marginal, Conditional), ~ round(., 2))
```

```{r, include=F}
table_s4_rel_secular_por_ranfx <- stargazer(r11_secular, r13_secular,
                                            r14_secular, r16_secular, 
                                            r18_secular, 
                                            type = "html",
                                            ci = T,
                                            report = c("vcsp"),
                                            digits = 2,
                                            digits.extra = 1000,
                                            omit.table.layout = "n",
                                            order = c("^`Porosity Scale`$",
                                                      "^Absorption$",
                                                      "^`Porosity Scale`:Absorption$"),
                                            dep.var.labels.include = F,
                                            dep.var.caption = "",
                                            single.row = T)

cat(sub_interact_fun(table_s4_rel_secular_por_ranfx), 
    file = "./stargazer_tables/table_s4_rel_secular_por_ranfx.html")
```

```{r}
rsquared(modelList = list(r11_secular, r13_secular, r14_secular, 
                          r16_secular, r18_secular)) %>%
  mutate_at(vars(Marginal, Conditional), ~ round(., 2))
```


#### By country

##### Porosity Vignettes

```{r}
r19_secular_us <- lmer(Score ~ Scale * `Porosity Vignettes` 
                       + (1 | subject_id),
                       data = d4_fortab_secular_long %>% filter(Country == "US") %>%
                         mutate_at(vars(Score, `Porosity Vignettes`), ~ scale(.)))

r19_secular_gh <- lmer(Score ~ Scale * `Porosity Vignettes` 
                       + (1 | subject_id),
                       data = d4_fortab_secular_long %>% filter(Country == "Ghana") %>%
                         mutate_at(vars(Score, ,`Porosity Vignettes`), ~ scale(.)))

r19_secular_th <- lmer(Score ~ Scale * `Porosity Vignettes` 
                       + (1 | subject_id),
                       data = d4_fortab_secular_long %>% filter(Country == "Thailand") %>%
                         mutate_at(vars(Score, `Porosity Vignettes`), ~ scale(.)))

r19_secular_ch <- lmer(Score ~ Scale * `Porosity Vignettes` 
                       + (1 | subject_id),
                       data = d4_fortab_secular_long %>% filter(Country == "China") %>%
                         mutate_at(vars(Score, `Porosity Vignettes`), ~ scale(.)))

r19_secular_vt <- lmer(Score ~ Scale * `Porosity Vignettes` 
                       + (1 | subject_id),
                       data = d4_fortab_secular_long %>% filter(Country == "Vanuatu") %>%
                         mutate_at(vars(Score, `Porosity Vignettes`), ~ scale(.)))
```

```{r, include = F}
# # run manually to check convergence
# summary(r19_secular_us)
# summary(r19_secular_gh)
# summary(r19_secular_th)
# summary(r19_secular_ch)
# summary(r19_secular_vt)
```

```{r, include=F}
table_s4_rel_bycountry_secular_pv <- stargazer(r19_secular_us, r19_secular_gh,
                                               r19_secular_th, r19_secular_ch, 
                                               r19_secular_vt, 
                                               type = "html",
                                               ci = T,
                                               report = c("vcsp"),
                                               digits = 2,
                                               digits.extra = 1000,
                                               omit.table.layout = "n",
                                               order = c("^`Porosity Vignettes`$",
                                                         "^Absorption$",
                                                         "^`Porosity Vignettes`:Absorption$"),
                                               dep.var.labels.include = F,
                                               dep.var.caption = "",
                                               single.row = T)

cat(sub_interact_fun(table_s4_rel_bycountry_secular_pv), 
    file = "./stargazer_tables/table_s4_rel_bycountry_secular_pv.html")
```

```{r}
rsquared(modelList = list(r19_secular_us, r19_secular_gh, r19_secular_th, 
                          r19_secular_ch, r19_secular_vt)) %>%
  mutate_at(vars(Marginal, Conditional), ~ round(., 2))
```

##### Porosity Scale

```{r}
r20_secular_us <- lmer(Score ~ Scale * `Porosity Scale` 
                       + (1 | subject_id),
                       data = d4_fortab_secular_long %>% filter(Country == "US") %>%
                         mutate_at(vars(Score, `Porosity Scale`), ~ scale(.)))

r20_secular_gh <- lmer(Score ~ Scale * `Porosity Scale` 
                       + (1 | subject_id),
                       data = d4_fortab_secular_long %>% filter(Country == "Ghana") %>%
                         mutate_at(vars(Score, `Porosity Scale`), ~ scale(.)))

r20_secular_th <- lmer(Score ~ Scale * `Porosity Scale` 
                       + (1 | subject_id),
                       data = d4_fortab_secular_long %>% filter(Country == "Thailand") %>%
                         mutate_at(vars(Score, `Porosity Scale`), ~ scale(.)))

r20_secular_ch <- lmer(Score ~ Scale * `Porosity Scale` 
                       + (1 | subject_id),
                       data = d4_fortab_secular_long %>% filter(Country == "China") %>%
                         mutate_at(vars(Score, `Porosity Scale`), ~ scale(.)))

r20_secular_vt <- lmer(Score ~ Scale * `Porosity Scale` 
                       + (1 | subject_id),
                       data = d4_fortab_secular_long %>% filter(Country == "Vanuatu") %>%
                         mutate_at(vars(Score, `Porosity Scale`), ~ scale(.)))
```

```{r, include = F}
# # run manually to check convergence
# summary(r20_secular_us)
# summary(r20_secular_gh)
# summary(r20_secular_th)
# summary(r20_secular_ch)
# summary(r20_secular_vt)
```

```{r, include=F}
table_s4_rel_bycountry_secular_por <- stargazer(r20_secular_us, r20_secular_gh,
                                                r20_secular_th, r20_secular_ch, 
                                                r20_secular_vt, 
                                                type = "html",
                                                ci = T,
                                                report = c("vcsp"),
                                                digits = 2,
                                                digits.extra = 1000,
                                                omit.table.layout = "n",
                                                order = c("^`Porosity Scale`$",
                                                          "^Absorption$",
                                                          "^`Porosity Scale`:Absorption$"),
                                                dep.var.labels.include = F,
                                                dep.var.caption = "",
                                                single.row = T)

cat(sub_interact_fun(table_s4_rel_bycountry_secular_por), 
    file = "./stargazer_tables/table_s4_rel_bycountry_secular_por.html")
```

```{r}
rsquared(modelList = list(r20_secular_us, r20_secular_gh, r20_secular_th, 
                          r20_secular_ch, r20_secular_vt)) %>%
  mutate_at(vars(Marginal, Conditional), ~ round(., 2))
```

##### Absorption

```{r}
r21_secular_us <- lmer(Score ~ Scale * `Absorption` 
                       + (1 | subject_id),
                       data = d4_fortab_secular_long %>% filter(Country == "US") %>%
                         mutate_at(vars(Score, `Absorption`), ~ scale(.)))

r21_secular_gh <- lmer(Score ~ Scale * `Absorption` 
                       + (1 | subject_id),
                       data = d4_fortab_secular_long %>% filter(Country == "Ghana") %>%
                         mutate_at(vars(Score, `Absorption`), ~ scale(.)))

r21_secular_th <- lmer(Score ~ Scale * `Absorption` 
                       + (1 | subject_id),
                       data = d4_fortab_secular_long %>% filter(Country == "Thailand") %>%
                         mutate_at(vars(Score, `Absorption`), ~ scale(.)))

r21_secular_ch <- lmer(Score ~ Scale * `Absorption` 
                       + (1 | subject_id),
                       data = d4_fortab_secular_long %>% filter(Country == "China") %>%
                         mutate_at(vars(Score, `Absorption`), ~ scale(.)))

r21_secular_vt <- lmer(Score ~ Scale * `Absorption` 
                       + (1 | subject_id),
                       data = d4_fortab_secular_long %>% filter(Country == "Vanuatu") %>%
                         mutate_at(vars(Score, `Absorption`), ~ scale(.)))
```

```{r, include = F}
# # run manually to check convergence
# summary(r21_secular_us)
# summary(r21_secular_gh)
# summary(r21_secular_th)
# summary(r21_secular_ch)
# summary(r21_secular_vt)
```

```{r, include=F}
table_s4_rel_bycountry_secular_abs <- stargazer(r21_secular_us, r21_secular_gh,
                                                r21_secular_th, r21_secular_ch, 
                                                r21_secular_vt, 
                                                type = "html",
                                                ci = T,
                                                report = c("vcsp"),
                                                digits = 2,
                                                digits.extra = 1000,
                                                omit.table.layout = "n",
                                                order = c("^Absorption$"),
                                                dep.var.labels.include = F,
                                                dep.var.caption = "",
                                                single.row = T)

cat(sub_interact_fun(table_s4_rel_bycountry_secular_abs), 
    file = "./stargazer_tables/table_s4_rel_bycountry_secular_abs.html")
```

```{r}
rsquared(modelList = list(r21_secular_us, r21_secular_gh, r21_secular_th, 
                          r21_secular_ch, r21_secular_vt)) %>%
  mutate_at(vars(Marginal, Conditional), ~ round(., 2))
```

## Predictors of interest vs. control measures

```{r}
d4_fortab_interest <- d4_fortab %>% 
  gather(Predictor, `Predictor Score`, 
         c(`Porosity Vignettes`, `Porosity Scale`, Absorption, 
           `Need for Cognition`, `Sense of Control`)) %>%
  mutate(Predictor = factor(Predictor,
                            levels = c("Porosity Vignettes", "Porosity Scale", 
                                       "Absorption", "Need for Cognition", 
                                       "Sense of Control")))

contrasts(d4_fortab_interest$Predictor) <- cbind(" A" = c(2, 2, 2, -3, -3),
                                                 " B" = c(1, 1, -2, 0, 0),
                                                 " C" = c(-1, 1, 0, 0, 0),
                                                 " D" = c(0, 0, 0, 1, -1)) 
contrasts(d4_fortab_interest$Predictor)
```

### Spiritual experiences

#### Sample as fixed effect

```{r}
r22_spev <- lm(`Spiritual Events` ~ Predictor * `Predictor Score`,
               data = d4_fortab_interest)

r23_spev <- lm(`Spiritual Events` ~ Predictor * `Predictor Score` * Country,
               data = d4_fortab_interest)

r24_spev <- lm(`Spiritual Events` ~ Predictor * `Predictor Score` * Country
               + Gender + Age,
               data = d4_fortab_interest)
```

```{r}
r22_dse <- lm(`Daily Spiritual Experience` ~ Predictor * `Predictor Score`,
              data = d4_fortab_interest)

r23_dse <- lm(`Daily Spiritual Experience` ~ Predictor * `Predictor Score` * Country,
              data = d4_fortab_interest)

r24_dse <- lm(`Daily Spiritual Experience` ~ Predictor * `Predictor Score` * Country 
              + Gender + Age,
              data = d4_fortab_interest)
```

```{r, include = F}
# # run manually to check convergence
# summary(r22_spev)
# summary(r23_spev)
# summary(r24_spev)
# summary(r22_dse)
# summary(r23_dse)
# summary(r24_dse)
```

```{r, include=F}
table_s4_predictor_spirit_fixfx <- stargazer(r22_spev, r23_spev, r24_spev,
                                             r22_dse, r23_dse, r24_dse,
                                             type = "html",
                                             ci = T,
                                             report = c("vcsp"),
                                             digits = 2,
                                             digits.extra = 1000,
                                             omit.table.layout = "n",
                                             dep.var.labels.include = F,
                                             dep.var.caption = "",
                                             single.row = T) 

cat(sub_interact_fun(table_s4_predictor_spirit_fixfx), 
    file = "./stargazer_tables/table_s4_predictor_spirit_fixfx.html")
```

#### Sample as random effect

```{r}
r25_spev <- lmer(`Spiritual Events` ~ Predictor * `Predictor Score`
                 # + (1 + Predictor * `Predictor Score` | Country), # perfectly correlated ranfx
                 # + (1 + Predictor + `Predictor Score` | Country), # perfectly correlated ranfx
                 + (1 | Country),
                 data = d4_fortab_interest)

r26_spev <- lmer(`Spiritual Events` ~ Predictor * `Predictor Score`
                 + Gender + Age
                 + (1 | Country),
                 data = d4_fortab_interest)

r25_dse <- lmer(`Daily Spiritual Experience` ~ Predictor * `Predictor Score`
                # + (1 + Predictor * `Predictor Score` | Country),
                + (1 | Country),
                data = d4_fortab_interest)

r26_dse <- lmer(`Daily Spiritual Experience` ~ Predictor * `Predictor Score`
                + Gender + Age
                + (1 | Country),
                data = d4_fortab_interest)
```

```{r, include = F}
# # run manually to check convergence
# summary(r25_spev)
# summary(r26_spev)
# summary(r25_dse)
# summary(r26_dse)
```

```{r, include=F}
table_s4_predictor_spirit_ranfx <- stargazer(r25_spev, r26_spev,
                                             r25_dse, r26_dse, 
                                             type = "html",
                                             ci = T,
                                             report = c("vcsp"),
                                             digits = 2,
                                             digits.extra = 1000,
                                             omit.table.layout = "n",
                                             dep.var.labels.include = F,
                                             dep.var.caption = "",
                                             single.row = T)

cat(sub_interact_fun(table_s4_predictor_spirit_ranfx), 
    file = "./stargazer_tables/table_s4_predictor_spirit_ranfx.html")
```

```{r}
rsquared(modelList = list(r25_spev, r26_spev, r25_dse, r26_dse)) %>%
  mutate_at(vars(Marginal, Conditional), ~ round(., 2))
```


### Secular experiences

#### Sample as fixed effect

```{r}
r22_hall <- lm(`Hallucinations` ~ Predictor * `Predictor Score`,
               data = d4_fortab_interest)

r23_hall <- lm(`Hallucinations` ~ Predictor * `Predictor Score` * Country,
               data = d4_fortab_interest)

r24_hall <- lm(`Hallucinations` ~ Predictor * `Predictor Score` * Country
               + Gender + Age,
               data = d4_fortab_interest)
```

```{r}
r22_para <- lm(`Paranormal` ~ Predictor * `Predictor Score`,
               data = d4_fortab_interest)

r23_para <- lm(`Paranormal` ~ Predictor * `Predictor Score` * Country,
               data = d4_fortab_interest)

r24_para <- lm(`Paranormal` ~ Predictor * `Predictor Score` * Country 
               + Gender + Age,
               data = d4_fortab_interest)
```

```{r, include = F}
# # run manually to check convergence
# summary(r22_hall)
# summary(r23_hall)
# summary(r24_hall)
# summary(r22_para)
# summary(r23_para)
# summary(r24_para)
```

```{r, include=F}
table_s4_predictor_secular_fixfx <- stargazer(r22_hall, r23_hall, r24_hall,
                                              r22_para, r23_para, r24_para,
                                              type = "html",
                                              ci = T,
                                              report = c("vcsp"),
                                              digits = 2,
                                              digits.extra = 1000,
                                              omit.table.layout = "n",
                                              dep.var.labels.include = F,
                                              dep.var.caption = "",
                                              single.row = T) 

cat(sub_interact_fun(table_s4_predictor_secular_fixfx), 
    file = "./stargazer_tables/table_s4_predictor_secular_fixfx.html")
```

#### Sample as random effect

```{r}
r25_hall <- lmer(`Hallucinations` ~ Predictor * `Predictor Score`
                 # + (1 + Predictor * `Predictor Score` | Country), # perfectly correlated ranfx
                 # + (1 + Predictor + `Predictor Score` | Country), # perfectly correlated ranfx
                 + (1 | Country),
                 data = d4_fortab_interest)

r26_hall <- lmer(`Hallucinations` ~ Predictor * `Predictor Score`
                 + Gender + Age
                 + (1 | Country),
                 data = d4_fortab_interest)

r25_para <- lmer(`Paranormal` ~ Predictor * `Predictor Score`
                 # + (1 + Predictor * `Predictor Score` | Country),
                 + (1 | Country),
                 data = d4_fortab_interest)

r26_para <- lmer(`Paranormal` ~ Predictor * `Predictor Score`
                 + Gender + Age
                 + (1 | Country),
                 data = d4_fortab_interest)
```

```{r, include = F}
# # run manually to check convergence
# summary(r25_hall)
# summary(r26_hall)
# summary(r25_para)
# summary(r26_para)
```

```{r, include=F}
table_s4_predictor_secular_ranfx <- stargazer(r25_hall, r26_hall,
                                              r25_para, r26_para, 
                                              type = "html",
                                              ci = T,
                                              report = c("vcsp"),
                                              digits = 2,
                                              digits.extra = 1000,
                                              omit.table.layout = "n",
                                              dep.var.labels.include = F,
                                              dep.var.caption = "",
                                              single.row = T)

cat(sub_interact_fun(table_s4_predictor_secular_ranfx), 
    file = "./stargazer_tables/table_s4_predictor_secular_ranfx.html")
```

```{r}
rsquared(modelList = list(r25_hall, r26_hall, r25_para, r26_para)) %>%
  mutate_at(vars(Marginal, Conditional), ~ round(., 2))
```




# NEW

## Omitting reverse-coded items from control scales

```{r}
d4_byquestion <- read_csv("./data_by_question/study4_byquestion.csv")
```

```{r}
d4_norev <- d4_byquestion %>% 
  select(p7_ctry, p7_subj, contains("hthk"), contains("wob"), 
         -contains("cat")) %>%
  gather(question, response, -c(p7_ctry, p7_subj)) %>%
  mutate(scale = case_when(grepl("hthk", question) ~ "cog",
                           grepl("wob", question) ~ "ctl",
                           TRUE ~ NA_character_)) %>%
  # omit reverse-coded items from need for cognition (9 of 18 items)
  filter(!question %in% c("p7_hthk_not.fun", "p7_hthk_lil.challeng", 
                          "p7_hthk_avoid.think", "p7_hthk_hrd.hav.to", 
                          "p7_hthk_smal.daily", "p7_hthk_lil.thought", 
                          "p7_hthk_not.exciting", "p7_hthk_mental.effrt", 
                          "p7_hthk_job.done")) %>%
  # omit reverse-coded items from sense of control (4 of 12 items)
  filter(!question %in% c("p7_wob_set.mind_reverse", "p7_wob_find.ways_reverse",
                          "p7_wob_own.hands_reverse", "p7_wob_future.on.me_reverse")) %>%
  group_by(p7_ctry, p7_subj, scale) %>%
  summarise(score = mean(response, na.rm = T),
            scores = scale(score)) %>%
  ungroup() %>%
  spread(scale, score) %>%
  rename("Need for Cognition, no reverse-coding" = "cog",
         "Sense of Control, no reverse-coding" = "ctl",
         "Country" = "p7_ctry",
         "subject_id" = "p7_subj") %>%
  full_join(d4_fortab)
```

## Predictors of interest vs. control measures

```{r}
d4_norev_interest <- d4_norev %>% 
  gather(Predictor, `Predictor Score`, 
         c(`Porosity Vignettes`, `Porosity Scale`, Absorption, 
           `Need for Cognition, no reverse-coding`, `Sense of Control, no reverse-coding`)) %>%
  mutate(Predictor = factor(Predictor,
                            levels = c("Porosity Vignettes", "Porosity Scale", 
                                       "Absorption", 
                                       "Need for Cognition, no reverse-coding", 
                                       "Sense of Control, no reverse-coding")))

contrasts(d4_norev_interest$Predictor) <- cbind(" A" = c(2, 2, 2, -3, -3),
                                                " B" = c(1, 1, -2, 0, 0),
                                                " C" = c(-1, 1, 0, 0, 0),
                                                " D" = c(0, 0, 0, 1, -1)) 
contrasts(d4_norev_interest$Predictor)
```

### Spiritual experiences

#### Sample as fixed effect

```{r}
r22_norev_spev <- lm(`Spiritual Events` ~ Predictor * `Predictor Score`,
                     data = d4_norev_interest)

r23_norev_spev <- lm(`Spiritual Events` ~ Predictor * `Predictor Score` * Country,
                     data = d4_norev_interest)

r24_norev_spev <- lm(`Spiritual Events` ~ Predictor * `Predictor Score` * Country
                     + Gender + Age,
                     data = d4_norev_interest)
```

```{r}
r22_norev_dse <- lm(`Daily Spiritual Experience` ~ Predictor * `Predictor Score`,
                    data = d4_norev_interest)

r23_norev_dse <- lm(`Daily Spiritual Experience` ~ Predictor * `Predictor Score` * Country,
                    data = d4_norev_interest)

r24_norev_dse <- lm(`Daily Spiritual Experience` ~ Predictor * `Predictor Score` * Country 
                    + Gender + Age,
                    data = d4_norev_interest)
```

```{r, include = F}
# # run manually to check convergence
# summary(r22_norev_spev)
# summary(r23_norev_spev)
# summary(r24_norev_spev)
# summary(r22_norev_dse)
# summary(r23_norev_dse)
# summary(r24_norev_dse)
```

```{r, include=F}
table_s4_predictor_norev_spirit_fixfx <- stargazer(r22_norev_spev, 
                                                   r23_norev_spev, 
                                                   r24_norev_spev,
                                                   r22_norev_dse, 
                                                   r23_norev_dse, 
                                                   r24_norev_dse,
                                                   type = "html",
                                                   ci = T,
                                                   report = c("vcsp"),
                                                   digits = 2,
                                                   digits.extra = 1000,
                                                   omit.table.layout = "n",
                                                   dep.var.labels.include = F,
                                                   dep.var.caption = "",
                                                   single.row = T) 

cat(sub_interact_fun(table_s4_predictor_norev_spirit_fixfx), 
    file = "./stargazer_tables/table_s4_predictor_norev_spirit_fixfx.html")
```

#### Sample as random effect

```{r}
r25_norev_spev <- lmer(`Spiritual Events` ~ Predictor * `Predictor Score`
                       # + (1 + Predictor * `Predictor Score` | Country), # perfectly correlated ranfx
                       # + (1 + Predictor + `Predictor Score` | Country), # perfectly correlated ranfx
                       + (1 | Country),
                       data = d4_norev_interest)

r26_norev_spev <- lmer(`Spiritual Events` ~ Predictor * `Predictor Score`
                       + Gender + Age
                       + (1 | Country),
                       data = d4_norev_interest)

r25_norev_dse <- lmer(`Daily Spiritual Experience` ~ Predictor * `Predictor Score`
                      # + (1 + Predictor * `Predictor Score` | Country),
                      + (1 | Country),
                      data = d4_norev_interest)

r26_norev_dse <- lmer(`Daily Spiritual Experience` ~ Predictor * `Predictor Score`
                      + Gender + Age
                      + (1 | Country),
                      data = d4_norev_interest)
```

```{r, include = F}
# # run manually to check convergence
# summary(r25_norev_spev)
# summary(r26_norev_spev)
# summary(r25_norev_dse)
# summary(r26_norev_dse)
```

```{r, include=F}
table_s4_predictor_norev_spirit_ranfx <- stargazer(r25_norev_spev, r26_norev_spev,
                                                   r25_norev_dse, r26_norev_dse, 
                                                   type = "html",
                                                   ci = T,
                                                   report = c("vcsp"),
                                                   digits = 2,
                                                   digits.extra = 1000,
                                                   omit.table.layout = "n",
                                                   dep.var.labels.include = F,
                                                   dep.var.caption = "",
                                                   single.row = T)

cat(sub_interact_fun(table_s4_predictor_norev_spirit_ranfx), 
    file = "./stargazer_tables/table_s4_predictor_norev_spirit_ranfx.html")
```

```{r}
rsquared(modelList = list(r25_norev_spev, r26_norev_spev, r25_norev_dse, r26_norev_dse)) %>%
  mutate_at(vars(Marginal, Conditional), ~ round(., 2))
```


### Secular experiences

#### Sample as fixed effect

```{r}
r22_norev_hall <- lm(`Hallucinations` ~ Predictor * `Predictor Score`,
                     data = d4_norev_interest)

r23_norev_hall <- lm(`Hallucinations` ~ Predictor * `Predictor Score` * Country,
                     data = d4_norev_interest)

r24_norev_hall <- lm(`Hallucinations` ~ Predictor * `Predictor Score` * Country
                     + Gender + Age,
                     data = d4_norev_interest)
```

```{r}
r22_norev_para <- lm(`Paranormal` ~ Predictor * `Predictor Score`,
                     data = d4_norev_interest)

r23_norev_para <- lm(`Paranormal` ~ Predictor * `Predictor Score` * Country,
                     data = d4_norev_interest)

r24_norev_para <- lm(`Paranormal` ~ Predictor * `Predictor Score` * Country 
                     + Gender + Age,
                     data = d4_norev_interest)
```

```{r, include = F}
# # run manually to check convergence
# summary(r22_norev_hall)
# summary(r23_norev_hall)
# summary(r24_norev_hall)
# summary(r22_norev_para)
# summary(r23_norev_para)
# summary(r24_norev_para)
```

```{r, include=F}
table_s4_predictor_norev_secular_fixfx <- stargazer(r22_norev_hall, r23_norev_hall, r24_norev_hall,
                                                    r22_norev_para, r23_norev_para, r24_norev_para,
                                                    type = "html",
                                                    ci = T,
                                                    report = c("vcsp"),
                                                    digits = 2,
                                                    digits.extra = 1000,
                                                    omit.table.layout = "n",
                                                    dep.var.labels.include = F,
                                                    dep.var.caption = "",
                                                    single.row = T) 

cat(sub_interact_fun(table_s4_predictor_norev_secular_fixfx), 
    file = "./stargazer_tables/table_s4_predictor_norev_secular_fixfx.html")
```

#### Sample as random effect

```{r}
r25_norev_hall <- lmer(`Hallucinations` ~ Predictor * `Predictor Score`
                       # + (1 + Predictor * `Predictor Score` | Country), # perfectly correlated ranfx
                       # + (1 + Predictor + `Predictor Score` | Country), # perfectly correlated ranfx
                       + (1 | Country),
                       data = d4_norev_interest)

r26_norev_hall <- lmer(`Hallucinations` ~ Predictor * `Predictor Score`
                       + Gender + Age
                       + (1 | Country),
                       data = d4_norev_interest)

r25_norev_para <- lmer(`Paranormal` ~ Predictor * `Predictor Score`
                       # + (1 + Predictor * `Predictor Score` | Country),
                       + (1 | Country),
                       data = d4_norev_interest)

r26_norev_para <- lmer(`Paranormal` ~ Predictor * `Predictor Score`
                       + Gender + Age
                       + (1 | Country),
                       data = d4_norev_interest)
```

```{r, include = F}
# # run manually to check convergence
# summary(r25_norev_hall)
# summary(r26_norev_hall)
# summary(r25_norev_para)
# summary(r26_norev_para)
```

```{r, include=F}
table_s4_predictor_norev_secular_ranfx <- stargazer(r25_norev_hall, r26_norev_hall,
                                                    r25_norev_para, r26_norev_para, 
                                                    type = "html",
                                                    ci = T,
                                                    report = c("vcsp"),
                                                    digits = 2,
                                                    digits.extra = 1000,
                                                    omit.table.layout = "n",
                                                    dep.var.labels.include = F,
                                                    dep.var.caption = "",
                                                    single.row = T)

cat(sub_interact_fun(table_s4_predictor_norev_secular_ranfx), 
    file = "./stargazer_tables/table_s4_predictor_norev_secular_ranfx.html")
```

```{r}
rsquared(modelList = list(r25_norev_hall, r26_norev_hall, r25_norev_para, r26_norev_para)) %>%
  mutate_at(vars(Marginal, Conditional), ~ round(., 2))
```




